version: "2.0"

screen:
  name: 가이드 대화
  route: /guide/:workId
  layout: main-sidebar

data_requirements:
  - resource: works
    needs: [id, name, type, base_pattern_id, status]
    filters:
      id: ":workId"

  - resource: guide_sessions
    needs: [id, work_id, current_step, conversation_log]
    filters:
      work_id: ":workId"

  - resource: patterns
    needs: [id, name, type, structure_preview]
    filters:
      id: "work.base_pattern_id"
    auth_required: false

components:
  - id: step_indicator
    type: stepper
    position: header
    function: 5단계 진행 상황 표시
    events:
      - on: click:step
        do: 완료된 단계로 이동 (미완료 단계는 비활성)

  - id: chat_area
    type: list
    position: main
    function: AI 대화 메시지 영역 (AI 버블 + 사용자 버블)
    data_source:
      resource: guide_sessions
    events:
      - on: scroll:top
        do: 이전 대화 기록 로드

  - id: user_input
    type: form
    position: main
    function: 사용자 입력 (텍스트 + 선택지 옵션)
    events:
      - on: submit
        do: Claude CLI로 메시지 전송, AI 응답 수신
      - on: click:option
        do: 선택지 선택 후 자동 전송

  - id: design_state_panel
    type: detail
    position: sidebar
    function: 현재 설계 상태 실시간 표시 (단계별 결과 누적)
    data_source:
      resource: guide_sessions

  - id: base_pattern_info
    type: card
    position: sidebar
    function: 기반 패턴 정보 (있는 경우만 표시)
    data_source:
      resource: patterns

  - id: step_nav_buttons
    type: button
    position: main
    function: 이전/다음 단계 이동 버튼
    events:
      - on: click:prev
        do: 이전 단계로 이동
      - on: click:next
        do: 다음 단계로 이동 (현재 단계 완료 시)

connections:
  navigations:
    - from: step_indicator
      to: /guide/:workId/preview
    - from: step_nav_buttons
      to: /guide/:workId/preview

  shared_components:
    - sidebar_nav
    - breadcrumb

  external:
    - claude_cli

tests:
  - name: 초기 로드 (패턴 기반)
    when: 패턴에서 시작
    then:
      - 5단계 스텝 인디케이터 표시 (Step 1 활성)
      - 기반 패턴 정보 사이드바에 표시
      - AI가 패턴 기반 첫 질문 제시

  - name: 초기 로드 (새로 만들기)
    when: 새로 만들기에서 시작
    then:
      - 5단계 스텝 인디케이터 표시 (Step 1 활성)
      - AI가 유형 선택 질문 제시

  - name: AI 대화
    when: 사용자 메시지 전송
    then:
      - Claude CLI 호출
      - AI 응답 스트리밍 표시
      - 설계 상태 패널 업데이트

  - name: 단계 이동
    when: "다음 단계" 버튼 클릭
    then:
      - 현재 단계 완료 표시
      - 다음 단계로 전환
      - AI가 다음 단계 첫 질문 제시

  - name: 미리보기 진입
    when: Step 5 완료
    then:
      - /guide/:workId/preview로 이동
